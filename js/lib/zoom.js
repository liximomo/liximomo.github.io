!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Zooming=t()}(this,function(){"use strict";var e=document.body,t=document.documentElement,n="WebkitAppearance"in document.documentElement.style?"-webkit-":"",o=function(e){return function(t){return t/e}},r=o(2),i=function(e,t){var n=new Image;n.onload=function(){t&&t(n)},n.src=e},a=function(){return window.pageYOffset||(t||e.parentNode||e).scrollTop},s=function(){var n=t.clientWidth||e.clientWidth,o=t.clientHeight||e.clientHeight;return{x:r(n),y:r(o)}},u=function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t.forEach(function(t){o?e.addEventListener(t,n[t]):e.removeEventListener(t,n[t])})},l={defaultZoomable:'img[data-action="zoom"]',enableGrab:!0,preloadImage:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",overlay:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,onOpen:null,onClose:null,onRelease:null,onBeforeOpen:null,onBeforeClose:null,onBeforeGrab:null,onBeforeMove:null,onBeforeRelease:null},c={target:{close:null,open:null},overlay:{init:{zIndex:998,backgroundColor:l.bgColor,position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0,transition:"opacity\n        "+l.transitionDuration+"s\n        "+l.transitionTimingFunction}},cursor:{default:"auto",zoomIn:n+"zoom-in",zoomOut:n+"zoom-out",grab:n+"grab",move:"move"}},d=function(e){var t={},n=["webkitTransition","transition","mozTransition"],o=["webkitTransform","transform","mozTransform"],r={transition:"transitionend",mozTransition:"transitionend",webkitTransition:"webkitTransitionEnd"};return n.some(function(n){if(void 0!==e.style[n])return t.transitionProp=n,t.transEndEvent=r[n],!0}),o.some(function(n){if(void 0!==e.style[n])return t.transformProp=n,t.transformCssProp=n.replace(/(.*)Transform/,"-$1-transform"),!0}),t},f=function(e,t){return function(n,o,r){var i=void 0;o.transition&&(i=o.transition,delete o.transition,o[e]=i),o.transform&&(i=o.transform,delete o.transform,o[t]=i);var a=n.style,s={};for(var u in o)r&&(s[u]=a[u]||""),a[u]=o[u];return s}},v=function(e){var t=s(),n={x:e.left+r(e.width),y:e.top+r(e.height)};return{x:t.x-n.x,y:t.y-n.y}},m=function(e,t,n){var o=r(e.width),i=r(e.height),a={x:n.x-o,y:n.y-i},s=a.x/o,u=a.y/i;return t+Math.min(s,u)},g=2,y=function(e,t){for(var n=e.length,o=e[0],r=n>1,i=l.scaleExtra,a=e.length,s=0,u=0,c={x:o.clientX,y:o.clientY},d={x:o.clientX,y:o.clientY};a--;){var f=e[a],v=[f.clientX,f.clientY],m=v[0],y=v[1];s+=m,u+=y,r&&(m<c.x?c.x=m:m>d.x&&(d.x=m),y<c.y?c.y=y:y>d.y&&(d.y=y))}if(r){var h=d.x-c.x,p=d.y-c.y;i=h>p?h/window.innerWidth*g:p/window.innerHeight*g}t(s/n,u/n,i)},h=void 0,p=200,b=["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],x=document.body,E=document.createElement("div"),w=void 0,T=void 0,L=!1,k=!1,A=!0,C=null,B=void 0,z=void 0,I=void 0,O=void 0,G=d(E),D=G.transformCssProp,M=G.transEndEvent,P=f(G.transitionProp,G.transformProp),R=function(e,t,n){return P(e,t,n)},W={click:function(e){e.preventDefault(),L?A?Y.close():Y.release():Y.open(e.currentTarget)},scroll:function(){var e=a();null===C&&(C=e);var t=C-e;Math.abs(t)>=l.scrollThreshold&&(C=null,Y.close())},keydown:function(e){var t=e.key||e.code;"Escape"!==t&&27!==e.keyCode||(A?Y.close():Y.release(function(){return Y.close()}))},mousedown:function(e){0===e.button&&(e.preventDefault(),O=setTimeout(function(){Y.grab(e.clientX,e.clientY)},p))},mousemove:function(e){A||Y.move(e.clientX,e.clientY)},mouseup:function(e){0===e.button&&(clearTimeout(O),A?Y.close():Y.release())},touchstart:function(e){e.preventDefault(),O=setTimeout(function(){y(e.touches,function(e,t,n){Y.grab(e,t,n)})},p)},touchmove:function(e){A||y(e.touches,function(e,t,n){Y.move(e,t,n)})},touchend:function(e){e.targetTouches.length>0||(clearTimeout(O),A?Y.close():Y.release())}},Y={listen:function(e){if("string"==typeof e){for(var t=document.querySelectorAll(e),n=t.length;n--;)Y.listen(t[n]);return h}if("IMG"===e.tagName)return e.style.cursor=c.cursor.zoomIn,e.addEventListener("click",W.click),l.preloadImage&&e.hasAttribute("data-original")&&i(e.getAttribute("data-original")),h},open:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.onOpen;if(!L&&!k&&(w="string"==typeof e?document.querySelector(e):e,"IMG"===w.tagName)){var n=Object.assign(l),o=["overlay"];o.forEach(function(e){var t=null;null!=(t=w.getAttribute("data-"+e))&&(n[e]=t)});var r=s();w.hasAttribute("data-width")&&w.hasAttribute("data-height")&&(r.x=w.getAttribute("data-width")/2,r.y=w.getAttribute("data-height")/2),n.onBeforeOpen&&n.onBeforeOpen(w),L=!0,k=!0,T=w.parentNode,!n.preloadImage&&w.hasAttribute("data-original")&&i(w.getAttribute("data-original"));var a=w.getBoundingClientRect();return B=v(a),z=m(a,n.scaleBase,r),w.offsetWidth,c.target.open={position:"relative",zIndex:999,cursor:n.enableGrab?c.cursor.grab:c.cursor.zoomOut,transition:D+"\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction,transform:"translate("+B.x+"px, "+B.y+"px) scale("+z+")"},c.target.close=R(w,c.target.open,!0),T.appendChild(E),setTimeout(function(){return E.style.opacity=n.overlay},30),document.addEventListener("scroll",W.scroll),document.addEventListener("keydown",W.keydown),w.addEventListener(M,function e(){w.removeEventListener(M,e),k=!1,n.enableGrab&&u(document,b,W,!0),w.hasAttribute("data-original")&&!function(){I=w.getAttribute("src");var e=w.getAttribute("data-original"),t=w.cloneNode(!1);t.setAttribute("src",e),t.style.position="fixed",t.style.visibility="hidden",x.appendChild(t),setTimeout(function(){w.setAttribute("src",e),x.removeChild(t)},10)}(),t&&t(w)}),h}},close:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.onClose;if(L&&!k)return l.onBeforeClose&&l.onBeforeClose(w),k=!0,w.offsetWidth,x.style.cursor=c.cursor.default,E.style.opacity=0,R(w,{transform:"none"}),document.removeEventListener("scroll",W.scroll),document.removeEventListener("keydown",W.keydown),w.addEventListener(M,function t(){w.removeEventListener(M,t),L=!1,k=!1,l.enableGrab&&u(document,b,W,!1),w.hasAttribute("data-original")&&w.setAttribute("src",I),R(w,c.target.close),T.removeChild(E),e&&e(w)}),h},grab:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.scaleExtra,o=arguments[3];if(L&&!k){l.onBeforeGrab&&l.onBeforeGrab(w),A=!1;var r=s(),i=r.x-e,a=r.y-t;R(w,{cursor:c.cursor.move,transform:"translate("+(B.x+i)+"px, "+(B.y+a)+"px)\n        scale("+(z+n)+")"}),w.addEventListener(M,function e(){w.removeEventListener(M,e),o&&o(w)})}},move:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.scaleExtra,o=arguments[3];if(L&&!k){l.onBeforeMove&&l.onBeforeMove(w),A=!1;var r=s(),i=r.x-e,a=r.y-t;R(w,{transition:D,transform:"translate("+(B.x+i)+"px, "+(B.y+a)+"px)\n        scale("+(z+n)+")"}),x.style.cursor=c.cursor.move,w.addEventListener(M,function e(){w.removeEventListener(M,e),o&&o(w)})}},release:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.onRelease;if(L&&!k)return l.onBeforeRelease&&l.onBeforeRelease(w),k=!0,R(w,c.target.open),x.style.cursor=c.cursor.default,w.addEventListener(M,function t(){w.removeEventListener(M,t),k=!1,A=!0,e&&e(w)}),h},config:function(e){if(!e)return l;for(var t in e)l[t]=e[t];return R(E,{backgroundColor:l.bgColor,transition:"opacity\n        "+l.transitionDuration+"s\n        "+l.transitionTimingFunction}),h}};return R(E,c.overlay.init),E.setAttribute("id","zoom-overlay"),E.addEventListener("click",function(){return Y.close()}),document.addEventListener("DOMContentLoaded",function(){Y.listen(l.defaultZoomable)}),Y});
